{% load custom_filters %}

{% comment %}
<div class="card mt-3">
    <div class="card-body">
        <h5 class="card-title">Insights and Recommendations</h5>
        <p class="card-text">
            <strong>Short Customer Lifespan:</strong> The average customer lifespan of 0.04 years (around 15 days) suggests a high customer churn rate. Investigate why customers do not return after their initial purchases. Consider strategies to improve customer retention, such as loyalty programs or follow-up marketing campaigns.<br><br>
            
            <strong>High Transaction Volume but Low Retention:</strong> The high number of purchases and revenue indicates good market activity, but the retention is poor. Focus on enhancing the customer experience to encourage repeat purchases.<br><br>
            
            <strong>Reevaluate Customer Acquisition Strategies:</strong> Given the low CLTV, itâ€™s crucial to optimize customer acquisition costs. However, the very low CAC suggests that the company is not spending much on acquiring customers, which might be fine but should be validated.<br><br>
            
            <strong>Improve Engagement:</strong> Since the APFR and Average Number of Purchases suggest customers do engage a few times, work on converting these few engagements into longer-term relationships. Implement engagement strategies such as personalized offers, excellent customer service, and regular communication.<br><br>
            
            <strong>Data Quality and Duration:</strong> The short period of data (about 10 months) might skew the lifespan calculation. Ensure that the dataset is comprehensive and covers a more extended period for more accurate insights.<br><br>
            
            <strong>Further Analysis:</strong> Conduct further segmentation to identify patterns within customer behavior. Perhaps certain customer segments (e.g., based on demographics or purchase behavior) exhibit longer lifespans and higher values.<br><br>
            
            <strong>Next Steps:</strong>
            <ul>
                <li>Extend Data Collection Period: Collect and analyze data over a more extended period to get a more accurate picture of customer lifespan and behavior.</li>
                <li>Customer Feedback: Gather feedback from customers to understand why they might not be returning and address those issues.</li>
                <li>Retention Programs: Implement programs focused on retaining customers beyond their initial purchases.</li>
            </ul>
        </p>
    </div>
</div> 
{% endcomment %}

{% if recommendations %}
<div class="card mt-3">
    <div class="card-body">
        <h5 class="card-title">
            {% if ai_mode %}
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="orange" class="bi bi-lightbulb" viewBox="0 0 16 16">
                    <path d="M2 6a6 6 0 1 1 10.174 4.31c-.203.196-.359.4-.453.619l-.762 1.769A.5.5 0 0 1 10.5 13a.5.5 0 0 1 0 1 .5.5 0 0 1 0 1l-.224.447a1 1 0 0 1-.894.553H6.618a1 1 0 0 1-.894-.553L5.5 15a.5.5 0 0 1 0-1 .5.5 0 0 1 0-1 .5.5 0 0 1-.46-.302l-.761-1.77a2 2 0 0 0-.453-.618A5.98 5.98 0 0 1 2 6m6-5a5 5 0 0 0-3.479 8.592c.263.254.514.564.676.941L5.83 12h4.342l.632-1.467c.162-.377.413-.687.676-.941A5 5 0 0 0 8 1"/>
                </svg>
            {% else %}
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="brown" class="bi bi-lightbulb-off" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M2.23 4.35A6 6 0 0 0 2 6c0 1.691.7 3.22 1.826 4.31.203.196.359.4.453.619l.762 1.769A.5.5 0 0 0 5.5 13a.5.5 0 0 0 0 1 .5.5 0 0 0 0 1l.224.447a1 1 0 0 0 .894.553h2.764a1 1 0 0 0 .894-.553L10.5 15a.5.5 0 0 0 0-1 .5.5 0 0 0 0-1 .5.5 0 0 0 .288-.091L9.878 12H5.83l-.632-1.467a3 3 0 0 0-.676-.941 4.98 4.98 0 0 1-1.455-4.405zm1.588-2.653.708.707a5 5 0 0 1 7.07 7.07l.707.707a6 6 0 0 0-8.484-8.484zm-2.172-.051a.5.5 0 0 1 .708 0l12 12a.5.5 0 0 1-.708.708l-12-12a.5.5 0 0 1 0-.708"/>
                </svg>
            {% endif %}

            <span>Insights and Recommendations</span>
        </h5>
        <ul class="card-text">
            {% for recommendation in recommendations %}
                <li class="m-4">
                    <strong>{{ recommendation.title }}:</strong> {{ recommendation.description|safe }}
                    <p class="text-secondary">{{ recommendation.metrics}}</p>
                </li>
            {% endfor %}
        </ul>
    </div>
</div>
{% endif %}